# Secrets Management Guide

> ๐ **Security Guide** | [Home](../README.md) > **Secrets Management**

## Overview

P9: Secrets Management ะพะฑะตัะฟะตัะธะฒะฐะตั ะฑะตะทะพะฟะฐัะฝะพะต ััะฐะฝะตะฝะธะต ะธ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต API ะบะปััะตะน GLM ะฑะตะท ัะธัะบะฐ ัะปััะฐะนะฝะพะณะพ ะบะพะผะผะธัะฐ ะฒ Git.

---

## Quick Start

### ะะฐัะธะฐะฝั A: ะะฝัะตัะฐะบัะธะฒะฝะฐั ะฝะฐัััะพะนะบะฐ (ะะตะบะพะผะตะฝะดัะตััั)

ะัะฟะพะปัะทัะนัะต ะพัะดะตะปัะฝัะน ัะบัะธะฟั ะฝะฐัััะพะนะบะธ:

```bash
./setup-secrets.sh
```

**ะัะฒะพะด:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ     GLM Docker Tools - Secrets Setup                           โ
โ     Interactive API Key Configuration                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[INFO]
[INFO] Get your API key from: https://z.ai/settings/api-keys
[INFO]

Enter your GLM API key: <paste your key>
[SUCCESS] โ Setup complete!
```

ะะฐัะตะผ ะทะฐะฟัััะธัะต Claude Code:

```bash
./glm-launch.sh
```

**ะัะตะธะผััะตััะฒะฐ:**
- ะัะดะตะปัะฝัะน ัะบัะธะฟั ะผะพะถะตั ะฑััั ะทะฐะฟััะตะฝ ะฝะตะทะฐะฒะธัะธะผะพ
- ะะพะฝััะฝัะต ัะพะพะฑัะตะฝะธั ะพะฑ ะพัะธะฑะบะฐั
- ะะฐะปะธะดะฐัะธั ัะพัะผะฐัะฐ ะบะปััะฐ
- CI/CD friendly (ะพัะฝะพะฒะฝะพะน ัะบัะธะฟั ะฝะต ะธะฝัะตัะฐะบัะธะฒะฝัะน)

---

### ะะฐัะธะฐะฝั B: ะััะฝะฐั ะฝะฐัััะพะนะบะฐ

```bash
# ะจะฐะณ 1: ะกะพะทะดะฐัั ะฟะฐะฟะบั ัะตะบัะตัะพะฒ
mkdir -p secrets

# ะจะฐะณ 2: ะะพะฑะฐะฒะธัั API ะบะปัั
echo "GLM_API_KEY=your_actual_key_here" > secrets/.env
chmod 600 secrets/.env

# ะจะฐะณ 3: ะะฐะฟัััะธัั Claude Code
./glm-launch.sh
```

---

### ะะฐัะธะฐะฝั C: ะะตัะตะผะตะฝะฝะฐั ะพะบััะถะตะฝะธั (CI/CD)

```bash
export GLM_API_KEY=your_key_here
./glm-launch.sh
```

---

## ะัะธะพัะธัะตั ะธััะพัะฝะธะบะพะฒ API ะบะปััะฐ

ะกะบัะธะฟั ะฟัะพะฒะตััะตั ะธััะพัะฝะธะบะธ ะฒ ัะปะตะดัััะตะผ ะฟะพััะดะบะต:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              API KEY SOURCE PRIORITY                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Priority 1: Environment Variable (CI/CD, runtime override)
   โโ> $GLM_API_KEY ะธะปะธ $ANTHROPIC_AUTH_TOKEN

Priority 2: Secrets File (local development)
   โโ> secrets/.env (GLM_API_KEY=...)

Priority 3: Existing Settings (backward compatibility)
   โโ> .claude/settings.json (ANTHROPIC_AUTH_TOKEN field)

Priority 4: Error message with setup instructions
   โโ> ะฃะบะฐะทะฐะฝะธะต ะฝะฐ ./setup-secrets.sh ะธะปะธ ัััะฝัั ะฝะฐัััะพะนะบั
```

**ะัะธะผะตัะฐะฝะธะต:** ะัะฝะพะฒะฝะพะน ัะบัะธะฟั `glm-launch.sh` ะฑะพะปััะต ะฝะต ัะพะดะตัะถะธั ะฒัััะพะตะฝะฝะพะณะพ
ะธะฝัะตัะฐะบัะธะฒะฝะพะณะพ ัะตะถะธะผะฐ. ะัะฟะพะปัะทัะนัะต `./setup-secrets.sh` ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝะพะน ะฝะฐัััะพะนะบะธ.

---

## ะััะธัะตะบัััะฐ

### ะกัััะบัััะฐ ะฟะฐะฟะพะบ

```
glm-docker-tools/
โโโ secrets/                          # ะะฐะฟะบะฐ ะดะปั ัะตะบัะตัะพะฒ
โ   โโโ .gitkeep                      # ะกะพััะฐะฝะตะฝะธะต ััััะบัััั ะฒ Git
โ   โโโ .env                          # ะะะจ API ะบะปัั (gitignored)
โ   โโโ .env.example                  # ะจะฐะฑะปะพะฝ ั ะธะฝััััะบัะธัะผะธ
โโโ .claude/
โ   โโโ settings.template.json        # ะจะฐะฑะปะพะฝ ะฝะฐัััะพะตะบ
โ   โโโ settings.json                 # ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ัะฐะนะป (gitignored)
โโโ glm-launch.sh                     # ะัะฝะพะฒะฝะพะน ัะบัะธะฟั
```

### Data Flow

```
User                   glm-launch.sh           inject into          Docker
creates          โ     reads secret       โ    settings.json   โ    container
secrets/.env           + validates             via jq               launches
```

---

## ะคะพัะผะฐั ัะฐะนะปะฐ secrets/.env

```bash
# GLM API Key Configuration
# Get your key from: https://z.ai/settings/api-keys
GLM_API_KEY=your_glm_api_key_here

# ะะปััะตัะฝะฐัะธะฒะฝะพะต ะธะผั (ะพะฑะฐ ัะฐะฑะพัะฐัั):
# ANTHROPIC_AUTH_TOKEN=your_glm_api_key_here
```

**ะะฐะถะฝะพ:**
- ะัะฟะพะปัะทัะนัะต ะขะะะฌะะ ะพะดะฝั ัััะพะบั ั ะบะปััะพะผ
- ะะปัั ะฑะตะท ะบะฐะฒััะตะบ
- ะคะฐะนะป ะดะพะปะถะตะฝ ะธะผะตัั ะฟัะฐะฒะฐ 600

---

## ะะตะทะพะฟะฐัะฝะพััั

### ะงัะพ ะทะฐัะธัะตะฝะพ

1. **Git Protection:**
   - `secrets/.env` ะฒ `.gitignore`
   - ะะตะฒะพะทะผะพะถะฝะพ ัะปััะฐะนะฝะพ ะทะฐะบะพะผะผะธัะธัั ะบะปัั

2. **File Permissions:**
   - ะะฒัะพะผะฐัะธัะตัะบะฐั ัััะฐะฝะพะฒะบะฐ `chmod 600`
   - ะขะพะปัะบะพ ะฒะปะฐะดะตะปะตั ะผะพะถะตั ัะธัะฐัั

3. **No Logging:**
   - ะะปัั ะฝะธะบะพะณะดะฐ ะฝะต ะฒัะฒะพะดะธััั ะฒ ะปะพะณะธ
   - ะขะพะปัะบะพ ะธััะพัะฝะธะบ ะทะฐะณััะทะบะธ ะปะพะณะธััะตััั

4. **Runtime Injection:**
   - ะะปัั ะฝะต ะฒ Docker ะพะฑัะฐะทะต
   - ะะฝัะตะบัะธั ะฒะพ ะฒัะตะผั ะทะฐะฟััะบะฐ

### Best Practices

โ **DO:**
- ะัะฟะพะปัะทัะนัะต `secrets/.env` ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
- ะัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั ะฒ CI/CD
- ะะตะณัะปััะฝะพ ัะพัะธััะนัะต ะบะปััะธ
- ะฃััะฐะฝะฐะฒะปะธะฒะฐะนัะต ะฟัะฐะฒะฐ 600 ะฝะฐ ัะฐะนะปั ั ัะตะบัะตัะฐะผะธ

โ **DON'T:**
- ะะธะบะพะณะดะฐ ะฝะต ะบะพะผะผะธัััะต `secrets/.env` ะฒ Git
- ะะต ััะฐะฝะธัะต ะบะปััะธ ะฒ ะธััะพัะธะธ ะบะพะผะฐะฝะด shell
- ะะต ะฟะตัะตะดะฐะฒะฐะนัะต ะบะปััะธ ัะตัะตะท ะฝะตะทะฐัะธััะฝะฝัะต ะบะฐะฝะฐะปั
- ะะต ะธัะฟะพะปัะทัะนัะต ะพะดะธะฝ ะบะปัั ะดะปั ะฒัะตั ะพะบััะถะตะฝะธะน

---

## Troubleshooting

### ะัะธะฑะบะฐ: "API key not found"

**ะัะธัะธะฝะฐ:** ะะตั ะบะปััะฐ ะฝะธ ะฒ ะพะดะฝะพะผ ะธะท ะธััะพัะฝะธะบะพะฒ.

**ะะตัะตะฝะธะต:**
```bash
# ะะฐัะธะฐะฝั 1: ะกะพะทะดะฐัั secrets/.env
mkdir -p secrets
echo "GLM_API_KEY=your_key" > secrets/.env
chmod 600 secrets/.env

# ะะฐัะธะฐะฝั 2: ะฃััะฐะฝะพะฒะธัั ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
export GLM_API_KEY=your_key
```

---

### ะัะตะดัะฟัะตะถะดะตะฝะธะต: "Insecure permissions"

**ะัะธัะธะฝะฐ:** ะคะฐะนะป `secrets/.env` ะดะพัััะฟะตะฝ ะดะปั ััะตะฝะธั ะดััะณะธะผ ะฟะพะปัะทะพะฒะฐัะตะปัะผ.

**ะะตัะตะฝะธะต:**
```bash
chmod 600 secrets/.env
```

---

### ะัะตะดัะฟัะตะถะดะตะฝะธะต: "API key appears too short"

**ะัะธัะธะฝะฐ:** ะะปัั ะบะพัะพัะต 32 ัะธะผะฒะพะปะพะฒ (ะฒะพะทะผะพะถะฝะพ ะฝะตะฟัะฐะฒะธะปัะฝัะน).

**ะะตัะตะฝะธะต:**
- ะัะพะฒะตัััะต ะบะปัั ะฝะฐ https://z.ai/settings/api-keys
- ะฃะฑะตะดะธัะตัั ััะพ ัะบะพะฟะธัะพะฒะฐะปะธ ะบะปัั ะฟะพะปะฝะพัััั
- ะะฐะถะผะธัะต `y` ะดะปั ะฟัะพะดะพะปะถะตะฝะธั, ะตัะปะธ ะบะปัั ะฟัะฐะฒะธะปัะฝัะน

---

## ะะฝัะตะณัะฐัะธั ั CI/CD

### GitHub Actions

```yaml
name: Deploy GLM Docker Tools

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up secrets
        env:
          GLM_API_KEY: ${{ secrets.GLM_API_KEY }}
        run: |
          ./glm-launch.sh
```

### GitLab CI

```yaml
deploy:
  script:
    - export GLM_API_KEY=$GLM_API_KEY
    - ./glm-launch.sh
  variables:
    GLM_API_KEY:
      value: $GLM_API_KEY
      masked: true
```

---

## ะะพัะฐัะธั ะบะปััะตะน

1. **ะะพะปััะธัั ะฝะพะฒัะน ะบะปัั** ะพั https://z.ai/settings/api-keys

2. **ะะฑะฝะพะฒะธัั secrets/.env:**
   ```bash
   nano secrets/.env
   # ะะฐะผะตะฝะธัั ััะฐััะน ะบะปัั ะฝะฐ ะฝะพะฒัะน
   ```

3. **ะะตัะตะทะฐะฟัััะธัั ะบะพะฝัะตะนะฝะตั:**
   ```bash
   ./glm-launch.sh
   ```

ะะปัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะฝัะตะบัะธััะตััั ะฟัะธ ะบะฐะถะดะพะผ ะทะฐะฟััะบะต.

---

## FAQ

### Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ะฝะตัะบะพะปัะบะพ ะบะปััะตะน?

**A:** ะะตั, ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะพะดะธะฝ ะบะปัั. ะัะธะพัะธัะตั: env variable > secrets/.env > existing settings.

### Q: ะะดะต ััะฐะฝะธััั ะบะปัั ะฒ ะบะพะฝัะตะนะฝะตัะต?

**A:** ะะปัั ะธะฝัะตะบัะธััะตััั ะฒ `/workspace/.claude/settings.json` ะฒะฝัััะธ ะบะพะฝัะตะนะฝะตัะฐ.

### Q: ะงัะพ ะตัะปะธ ั ะทะฐะฑัะป ะบะปัั?

**A:** ะัะพััะพ ะทะฐะฟัััะธัะต `./glm-launch.sh` ะฑะตะท `secrets/.env` - ัะบัะธะฟั ะฟัะตะดะปะพะถะธั ะฒะฒะตััะธ ะบะปัั ะทะฐะฝะพะฒะพ.

### Q: ะะตะทะพะฟะฐัะฝะพ ะปะธ ััะฐะฝะธัั ะบะปัั ะฒ ัะฐะนะปะต?

**A:** ะะฐ, ะฟัะธ ััะปะพะฒะธะธ:
- ะคะฐะนะป ะธะผะตะตั ะฟัะฐะฒะฐ 600
- ะคะฐะนะป ะฒ `.gitignore`
- ะะต ะดะตะปะธััั ัะตัะตะท ะฝะตะทะฐัะธััะฝะฝัะต ะบะฐะฝะฐะปั

---

## ะกะฒัะทะฐะฝะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

- **[Script Logic](./SCRIPT_LOGIC.md)** - ะะพะณะธะบะฐ ัะฐะฑะพัั ัะบัะธะฟัะฐ
- **[UAT Plan](./uat/P9_secrets_management_uat.md)** - ะะปะฐะฝ ัะตััะธัะพะฒะฐะฝะธั
- **[Security Guidelines](../SECURITY.md)** - ะะฑัะธะต ะฟัะฐะฒะธะปะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ
- **[Feature Implementation](./FEATURE_IMPLEMENTATION_WITH_UAT.md)** - ะะตัะพะดะพะปะพะณะธั UAT v2.0

---

**Last Updated:** 2026-01-14
**Feature:** P9 - Secrets Management
**Status:** โ Implemented
